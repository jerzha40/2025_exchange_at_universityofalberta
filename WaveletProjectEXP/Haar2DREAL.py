import numpy as np

"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
logging:
    - logging
"""
import logging
from logging.handlers import RotatingFileHandler

# â”€â”€ è®¾ç½®ä¸“å± logger â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
logger = logging.getLogger("activeLOG")  # ç»™å®ƒå‘½åï¼Œé¿å… root logger æ··æ·†
logger.setLevel(logging.INFO)
logger.propagate = False  # ğŸš« ä¸ä¼ æ’­ç»™ root loggerï¼Œé¿å… print å‡ºç°åœ¨ terminal
# ç¡®ä¿ log è·¯å¾„å­˜åœ¨
handler = RotatingFileHandler(
    filename=str("Haar2D.log"),
    maxBytes=10 * 1024 * 1024,
    backupCount=10,
    encoding="utf-8",
)
formatter = logging.Formatter("%(asctime)s [%(levelname)s] - %(message)s")
handler.setFormatter(formatter)
# æ¸…ç†æ—§ handler é¿å…é‡å¤æ·»åŠ 
if logger.hasHandlers():
    logger.handlers.clear()
logger.addHandler(handler)
"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""
logger.info(f"START")
"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""
N = 6
f = np.load("matrix.npy")
logger.info(f"f={f}")
"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""
Ïˆ = np.concatenate(
    [
        np.sqrt(2 ** (-N)) * np.ones(2 ** (N - 1)),
        -np.sqrt(2 ** (-N)) * np.ones(2 ** (N - 1)),
    ]
)
logger.info(f"Ïˆ={Ïˆ}")
"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""
Ï† = np.concatenate(
    [
        np.sqrt(2 ** (-N)) * np.ones(2 ** (N - 1)),
        np.sqrt(2 ** (-N)) * np.ones(2 ** (N - 1)),
    ]
)
logger.info(f"Ï†={Ï†}")
"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""
logger.info(f"âŸ¨Ïˆ, ÏˆâŸ©={np.sum(np.outer(Ïˆ,Ïˆ)**2)}")
"""check âŸ¨Ïˆ, ÏˆâŸ©=1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""
f_hat = np.zeros([2**N, 2**N])
f_hat[0][0] = np.sum(f * np.outer(Ï†, Ï†))
logger.info(f"f_hat[0][0]={f_hat[0][0]}")
"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""


def DEC2DY(a, b, l, r, j, k, m, n, f_hat, f):
    if r - l == 1:
        return
    c = 0
    for i in range(a, b):
        for s in range(l, r):
            c += (
                f[i][s]
                * np.sqrt(2**j)
                * Ïˆ[2**j * i - 2**N * k]
                * np.sqrt(2**m)
                * Ïˆ[2**m * s - 2**N * n]
            )
    f_hat[2**j + k][2**m + n] = c
    DEC2DY(a, b, l, (l + r) // 2, j, k, m + 1, n * 2 + 0, f_hat, f)
    DEC2DY(a, b, (l + r) // 2, r, j, k, m + 1, n * 2 + 1, f_hat, f)
    pass


def DEC2DX(a, b, j, k, f_hat, f):
    if b - a == 1:
        return
    DEC2DY(a, b, 0, 2**N, j, k, 0, 0, f_hat, f)
    DEC2DX(a, (a + b) // 2, j + 1, k * 2 + 0, f_hat, f)
    DEC2DX((a + b) // 2, b, j + 1, k * 2 + 1, f_hat, f)


def DEC2DEdge(a, b, j, k, f_hat, f):
    if b - a == 1:
        return
    ca = 0
    cc = 0
    for i in range(a, b):
        for s in range(0, 2**N):
            ca += f[i][s] * np.sqrt(2**j) * Ïˆ[2**j * i - 2**N * k] * Ï†[s]
            cc += f[s][i] * np.sqrt(2**j) * Ï†[s] * Ïˆ[2**j * i - 2**N * k]
    f_hat[2**j + k][0] = ca
    f_hat[0][2**j + k] = cc
    DEC2DEdge(a, (a + b) // 2, j + 1, k * 2 + 0, f_hat, f)
    DEC2DEdge((a + b) // 2, b, j + 1, k * 2 + 1, f_hat, f)


logger.info(f"f_hat={f_hat}")
DEC2DEdge(0, 2**N, 0, 0, f_hat, f)
DEC2DX(0, 2**N, 0, 0, f_hat, f)
logger.info(f"f_hat={f_hat}")
"""[a,b) c_{j,k}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""
f_rec = np.outer(Ï†, Ï†) * f_hat[0][0]
logger.info(f"f_rec_0={f_rec}")


def REC2DY(a, b, l, r, j, k, m, n, f_hat, f):
    if r - l == 1:
        return
    c = f_hat[2**j + k][2**m + n]
    for i in range(a, b):
        for s in range(l, r):
            f[i][s] += (
                c
                * np.sqrt(2**j)
                * Ïˆ[2**j * i - 2**N * k]
                * np.sqrt(2**m)
                * Ïˆ[2**m * s - 2**N * n]
            )
    REC2DY(a, b, l, (l + r) // 2, j, k, m + 1, n * 2 + 0, f_hat, f)
    REC2DY(a, b, (l + r) // 2, r, j, k, m + 1, n * 2 + 1, f_hat, f)
    pass


def REC2DX(a, b, j, k, f_hat, f):
    if b - a == 1:
        return
    REC2DY(a, b, 0, 2**N, j, k, 0, 0, f_hat, f)
    REC2DX(a, (a + b) // 2, j + 1, k * 2 + 0, f_hat, f)
    REC2DX((a + b) // 2, b, j + 1, k * 2 + 1, f_hat, f)


def REC2DEdge(a, b, j, k, f_hat, f):
    if b - a == 1:
        return
    ca = f_hat[2**j + k][0]
    cc = f_hat[0][2**j + k]
    for i in range(a, b):
        for s in range(0, 2**N):
            f[i][s] += ca * np.sqrt(2**j) * Ïˆ[2**j * i - 2**N * k] * Ï†[s]
            f[s][i] += cc * np.sqrt(2**j) * Ï†[s] * Ïˆ[2**j * i - 2**N * k]
    REC2DEdge(a, (a + b) // 2, j + 1, k * 2 + 0, f_hat, f)
    REC2DEdge((a + b) // 2, b, j + 1, k * 2 + 1, f_hat, f)


REC2DEdge(0, 2**N, 0, 0, f_hat, f_rec)
REC2DX(0, 2**N, 0, 0, f_hat, f_rec)
logger.info(f"f_rec={f_rec}")
logger.info(f"f={f}")
"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""
for i in range(2**N):
    for j in range(2**N):
        if np.abs(f_hat[i][j]) < 0.1:
            f_hat[i][j] = 0
print(f_hat)
f_rec_comp = np.outer(Ï†, Ï†) * f_hat[0][0]
REC2DEdge(0, 2**N, 0, 0, f_hat, f_rec_comp)
REC2DX(0, 2**N, 0, 0, f_hat, f_rec_comp)
logger.info(f"f_rec_comp={f_rec_comp}")
logger.info(f"f={f}")
"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""
from npytogrey import npy_to_binary_image

np.save("f_rec_comp", f_rec_comp)
npy_to_binary_image("f_rec_comp.npy", "denoise.png")
"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"""
